services:
  peer1:
    build: .
    container_name: p2p-peer1
    hostname: peer1
    networks:
      p2p_network:
        ipv4_address: 172.20.0.2
    environment:
      - PEER_ID=peer1
      - BROADCAST_ADDRESS=172.20.255.255
      - FILE_SERVER_PORT=50001
      - VIDEO_DIR=/videos
      - BUFFER_DIR=/buffer
    volumes:
      - ./videos_peer1:/videos:ro
      - ./buffer_peer1:/buffer
    ports:
      - "51000:50000/udp"  # Discovery port mapped to 51000 on host
      - "51001:50001/tcp"  # File server port mapped to 51001 on host
    restart: unless-stopped

  peer2:
    build: .
    container_name: p2p-peer2
    hostname: peer2
    networks:
      p2p_network:
        ipv4_address: 172.20.0.3
    environment:
      - PEER_ID=peer2
      - BROADCAST_ADDRESS=172.20.255.255
      - FILE_SERVER_PORT=50001
      - VIDEO_DIR=/videos
      - BUFFER_DIR=/buffer
    volumes:
      - ./videos_peer2:/videos:ro
      - ./buffer_peer2:/buffer
    ports:
      - "52000:50000/udp"  # Discovery port mapped to 52000 on host
      - "52001:50001/tcp"  # File server port mapped to 52001 on host
    restart: unless-stopped

  peer3:
    build: .
    container_name: p2p-peer3
    hostname: peer3
    networks:
      p2p_network:
        ipv4_address: 172.20.0.4
    environment:
      - PEER_ID=peer3
      - BROADCAST_ADDRESS=172.20.255.255
      - FILE_SERVER_PORT=50001
      - VIDEO_DIR=/videos
      - BUFFER_DIR=/buffer
    volumes:
      - ./videos_peer3:/videos:ro
      - ./buffer_peer3:/buffer
    ports:
      - "53000:50000/udp"  # Discovery port mapped to 53000 on host
      - "53001:50001/tcp"  # File server port mapped to 53001 on host
    restart: unless-stopped

networks:
  p2p_network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16
          gateway: 172.20.0.1
